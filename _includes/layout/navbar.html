<nav id="navbar" class="navbar fixed-top" style="z-index: 9999;">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <!-- Branding con bandera al lado -->
    <div class="d-flex align-items-center gap-2">
      <a class="navbar-brand" href="{{ '/' | relative_url }}">M: Paz</a>

      {% case page.lang %}
      {% when 'es' %}
      <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}"
           alt="Español"
           style="width: 20px; height: 20px; border-radius: 50%;">

      {% when 'fr' %}
      <img src="{{ '/assets/icons/fr.svg' | relative_url }}"
           alt="Français"
           style="width: 20px; height: 20px; border-radius: 50%;">

      {% else %}
      <img src="{{ '/assets/icons/gb.svg' | relative_url }}"
           alt="English"
           style="width: 20px; height: 20px; border-radius: 50%;">
      {% endcase %}
    </div>
    
    <!-- Botones: Idioma, Tema, Menú -->
    <div class="d-flex align-items-center gap-2">

      <!-- Menú desplegable de idiomas -->
      <div class="dropdown" id="language-dropdown">
        <button class="icon-button dropdown-toggle"
                id="language-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="{% if page.lang == 'es' %}Cambiar idioma{% elsif page.lang == 'fr' %}Changer de langue{% else %}Change language{% endif %}"
                title="{% if page.lang == 'es' %}Cambiar idioma{% elsif page.lang == 'fr' %}Changer de langue{% else %}Change language{% endif %}">
        </button>

        {% comment %}
        Quitamos cualquier prefijo de idioma (/en o /fr) del path actual
        para reconstruir correctamente las rutas base.
        {% endcomment %}
        {% assign base_url = page.url | remove_first: '/en' | remove_first: '/fr' %}

        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="language-toggle">
          <li>
            <a href="{{ base_url | relative_url }}" class="dropdown-item {% if page.lang == 'es' %}active{% endif %}">
              <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}" alt="Español" class="flag-icon me-2" style="width:16px; height:16px;">
              Español
            </a>
          </li>
          <li>
            <a href="{{ '/en' | append: base_url | relative_url }}" class="dropdown-item {% if page.lang == 'en' %}active{% endif %}">
              <img src="{{ '/assets/icons/gb.svg' | relative_url }}" alt="English" class="flag-icon me-2" style="width:16px; height:16px;">
              English
            </a>
          </li>
          <li>
            <a href="{{ '/fr' | append: base_url | relative_url }}" class="dropdown-item {% if page.lang == 'fr' %}active{% endif %}">
              <img src="{{ '/assets/icons/fr.svg' | relative_url }}" alt="Français" class="flag-icon me-2" style="width:16px; height:16px;">
              Français
            </a>
          </li>
        </ul>
      </div>

      <!-- Menú lateral de ajustes -->
      <div id="accessibility-sidebar" tabindex="-1" class="sidebar" aria-hidden="true" role="menu">
        <button class="icon-button" id="close-accessibility-toggle" aria-label="{% if page.lang == 'es' %}Cerrar ajustes{% elsif page.lang == 'fr' %}Fermer les paramètres{% else %}Close settings{% endif %}" title="{% if page.lang == 'es' %}Cerrar ajustes{% elsif page.lang == 'fr' %}Fermer les paramètres{% else %}Close settings{% endif %}"></button>

        <ul class="sidebar-nav list-unstyled">

          <!-- TEMA -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Tema
            {% when 'fr' %}Thème
            {% else %}Theme
            {% endcase %}
          </li>
          <li><button class="dropdown-item" data-theme-choice="light">
            {% case page.lang %}
            {% when 'es' %}Claro
            {% when 'fr' %}Clair
            {% else %}Light
            {% endcase %}
          </button></li>
          <li><button class="dropdown-item" data-theme-choice="dark">
            {% case page.lang %}
            {% when 'es' %}Oscuro
            {% when 'fr' %}Sombre
            {% else %}Dark
            {% endcase %}
          </button></li>

          <!-- CONTRASTE -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Contraste
            {% when 'fr' %}Contraste
            {% else %}Contrast
            {% endcase %}
          </li>
          {% assign levels = "low,medium,high" | split: "," %}
          {% for level in levels %}
          <li><button class="dropdown-item" data-contrast-choice="{{ level }}">
            {% case level %}
            {% when 'low' %}
            {% case page.lang %}
            {% when 'es' %}Bajo
            {% when 'fr' %}Faible
            {% else %}Low
            {% endcase %}
            {% when 'medium' %}
            {% case page.lang %}
            {% when 'es' %}Medio
            {% when 'fr' %}Moyen
            {% else %}Medium
            {% endcase %}
            {% when 'high' %}
            {% case page.lang %}
            {% when 'es' %}Alto
            {% when 'fr' %}Élevé
            {% else %}High
            {% endcase %}
            {% endcase %}
          </button></li>
          {% endfor %}

          <!-- DALTONISMO -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Daltonismo
            {% when 'fr' %}Daltonisme
            {% else %}Colorblind
            {% endcase %}
          </li>
          <li><button class="dropdown-item" data-colorblind-type="none">
            {% case page.lang %}
            {% when 'es' %}Ninguno
            {% when 'fr' %}Aucun
            {% else %}None
            {% endcase %}
          </button></li>
          <li><button class="dropdown-item" data-colorblind-type="protanopia">Protanopia</button></li>
          <li><button class="dropdown-item" data-colorblind-type="deuteranopia">Deuteranopia</button></li>
          <li><button class="dropdown-item" data-colorblind-type="tritanopia">Tritanopia</button></li>

          <!-- TAMAÑO DE TEXTO -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Tamaño de texto
            {% when 'fr' %}Taille du texte
            {% else %}Text Size
            {% endcase %}
          </li>
          {% assign sizes = "small,medium,large,xlarge" | split: "," %}
          {% for size in sizes %}
          <li><button class="dropdown-item" data-text-size="{{ size }}">
            {% case size %}
            {% when 'small' %}
            {% case page.lang %}
            {% when 'es' %}Pequeño
            {% when 'fr' %}Petit
            {% else %}Small
            {% endcase %}
            {% when 'medium' %}
            {% case page.lang %}
            {% when 'es' %}Mediano
            {% when 'fr' %}Moyen
            {% else %}Medium
            {% endcase %}
            {% when 'large' %}
            {% case page.lang %}
            {% when 'es' %}Grande
            {% when 'fr' %}Grand
            {% else %}Large
            {% endcase %}
            {% when 'xlarge' %}
            {% case page.lang %}
            {% when 'es' %}Muy grande
            {% when 'fr' %}Très grand
            {% else %}Extra Large
            {% endcase %}
            {% endcase %}
          </button></li>
          {% endfor %}

          <!-- OPCIONES AVANZADAS -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Opciones avanzadas
            {% when 'fr' %}Options avancées
            {% else %}Advanced Options
            {% endcase %}
          </li>

          <!-- Nivel de animación -->
          <li class="section-header">
            {% case page.lang %}
            {% when 'es' %}Animaciones
            {% when 'fr' %}Animations
            {% else %}Animations
            {% endcase %}
          </li>
          <li class="animation-slider-container">
            <label for="animation-slider">
              <span id="animation-slider-label">
                {% case page.lang %}
                {% when 'es' %}Nivel de animación
                {% when 'fr' %}Niveau d'animation
                {% else %}Animation Level
                {% endcase %}
              </span>
            </label>
            <input type="range"
                   id="animation-slider"
                   name="animation-slider"
                   min="0" max="2" step="1"
                   value="1"
                   data-animation-choice />
            <div class="animation-slider-labels">
              <span>
                {% case page.lang %}
                {% when 'es' %}Ninguna
                {% when 'fr' %}Aucune
                {% else %}None
                {% endcase %}
              </span>
              <span>
                {% case page.lang %}
                {% when 'es' %}Reducida
                {% when 'fr' %}Réduite
                {% else %}Reduced
                {% endcase %}
              </span>
              <span>
                {% case page.lang %}
                {% when 'es' %}Normal
                {% when 'fr' %}Normale
                {% else %}Normal
                {% endcase %}
              </span>
            </div>
          </li>

          <!-- Reading Mode -->
          <li class="d-flex align-items-center justify-content-between mt-2">
            <span>
              {% case page.lang %}
              {% when 'es' %}Modo lectura
              {% when 'fr' %}Mode lecture
              {% else %}Reading Mode
              {% endcase %}
            </span>
            <label class="switch">
              <input type="checkbox" id="reading-mode-toggle">
              <span class="slider"></span>
            </label>
          </li>

          <!-- Dyslexia Mode -->
          <li class="d-flex align-items-center justify-content-between">
            <span>
              {% case page.lang %}
              {% when 'es' %}Modo dislexia
              {% when 'fr' %}Mode dyslexie
              {% else %}Dyslexia Mode
              {% endcase %}
            </span>
            <label class="switch">
              <input type="checkbox" id="dyslexia-toggle">
              <span class="slider"></span>
            </label>
          </li>

        </ul>
      </div>

      <button class="icon-button" id="menu-toggle" aria-label="Abrir menú" title="Menú"></button>
    </div>
  </div>
</nav>

<!-- Menú lateral -->
<div id="sidebar-wrapper" tabindex="-1" class="sidebar" aria-hidden="true" role="menu">
  <button class="icon-button" id="close-menu-toggle" aria-label="{% if page.lang == 'es' %}Cerrar menú{% elsif page.lang == 'fr' %}Fermer le menu{% else %}Close menu{% endif %}" title="{% if page.lang == 'es' %}Cerrar{% elsif page.lang == 'fr' %}Fermer{% else %}Close{% endif %}"></button>

  <ul class="sidebar-nav list-unstyled">
    {% if page.lang == "es" %}
    <li><a href="{{ '/' | relative_url }}">Inicio</a></li>
    <li><a href="{{ '/sobre-mi.html' | relative_url }}">Sobre mí</a></li>
    <li><a href="{{ '/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/proyectos.html' | relative_url }}">Proyectos</a></li>
    <li><a href="{{ '/recursos.html' | relative_url }}">Recursos</a></li>
    <li><a href="{{ '/contacto.html' | relative_url }}">Contacto</a></li>

    {% elsif page.lang == "fr" %}
    <li><a href="{{ '/fr' | relative_url }}">Accueil</a></li>
    <li><a href="{{ '/fr/sobre-mi.html' | relative_url }}">À propos</a></li>
    <li><a href="{{ '/fr/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/fr/proyectos.html' | relative_url }}">Projets</a></li>
    <li><a href="{{ '/fr/recursos.html' | relative_url }}">Ressources</a></li>
    <li><a href="{{ '/fr/contacto.html' | relative_url }}">Contact</a></li>

    {% else %}
    <li><a href="{{ '/en' | relative_url }}">Home</a></li>
    <li><a href="{{ '/en/sobre-mi.html' | relative_url }}">About Me</a></li>
    <li><a href="{{ '/en/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/en/proyectos.html' | relative_url }}">Projects</a></li>
    <li><a href="{{ '/en/recursos.html' | relative_url }}">Resources</a></li>
    <li><a href="{{ '/en/contacto.html' | relative_url }}">Contact</a></li>
    {% endif %}
  </ul>
</div>
