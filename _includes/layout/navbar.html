<nav id="navbar" class="navbar fixed-top" style="z-index: 9999;">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <!-- Branding con bandera al lado -->
    <div class="d-flex align-items-center gap-2">
      <a class="navbar-brand" href="{{ '/' | relative_url }}">M: Paz</a>

      {% case page.lang %}
      {% when 'es' %}
      <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}"
           alt="Español"
           style="width: 20px; height: 20px; border-radius: 50%;">

      {% when 'fr' %}
      <img src="{{ '/assets/icons/fr.svg' | relative_url }}"
           alt="Français"
           style="width: 20px; height: 20px; border-radius: 50%;">

      {% else %}
      <img src="{{ '/assets/icons/gb.svg' | relative_url }}"
           alt="English"
           style="width: 20px; height: 20px; border-radius: 50%;">
      {% endcase %}
    </div>
    
    <!-- Botones: Idioma, Tema, Menú -->
    <div class="d-flex align-items-center gap-2">

      <!-- Menú desplegable de idiomas -->
      <div class="dropdown" id="language-dropdown">
        <button class="icon-button dropdown-toggle"
                id="language-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="{% if page.lang == 'es' %}Cambiar idioma{% elsif page.lang == 'fr' %}Changer de langue{% else %}Change language{% endif %}"
                title="{% if page.lang == 'es' %}Cambiar idioma{% elsif page.lang == 'fr' %}Changer de langue{% else %}Change language{% endif %}">
        </button>

        {% comment %}
        Quitamos cualquier prefijo de idioma (/en o /fr) del path actual
        para reconstruir correctamente las rutas base.
        {% endcomment %}
        {% assign base_url = page.url | remove_first: '/en' | remove_first: '/fr' %}

        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="language-toggle">
          <li>
            <a href="{{ base_url | relative_url }}" class="dropdown-item {% if page.lang == 'es' %}active{% endif %}">
              <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}" alt="Español" class="flag-icon me-2" style="width:16px; height:16px;">
              Español
            </a>
          </li>
          <li>
            <a href="{{ '/en' | append: base_url | relative_url }}" class="dropdown-item {% if page.lang == 'en' %}active{% endif %}">
              <img src="{{ '/assets/icons/gb.svg' | relative_url }}" alt="English" class="flag-icon me-2" style="width:16px; height:16px;">
              English
            </a>
          </li>
          <li>
            <a href="{{ '/fr' | append: base_url | relative_url }}" class="dropdown-item {% if page.lang == 'fr' %}active{% endif %}">
              <img src="{{ '/assets/icons/fr.svg' | relative_url }}" alt="Français" class="flag-icon me-2" style="width:16px; height:16px;">
              Français
            </a>
          </li>
        </ul>
      </div>
      
      <button class="icon-button" id="menu-toggle" aria-label="Abrir menú" title="Menú"></button>
    </div>
  </div>
</nav>

<!-- Menú lateral -->
<div id="sidebar-wrapper" tabindex="-1" class="sidebar" aria-hidden="true" role="menu">
  <button class="icon-button" id="close-menu-toggle" aria-label="{% if page.lang == 'es' %}Cerrar menú{% elsif page.lang == 'fr' %}Fermer le menu{% else %}Close menu{% endif %}" title="{% if page.lang == 'es' %}Cerrar{% elsif page.lang == 'fr' %}Fermer{% else %}Close{% endif %}"></button>

  <ul class="sidebar-nav list-unstyled">
    {% if page.lang == "es" %}
    <li><a href="{{ '/' | relative_url }}">Inicio</a></li>
    <li><a href="{{ '/sobre-mi.html' | relative_url }}">Sobre mí</a></li>
    <li><a href="{{ '/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/proyectos.html' | relative_url }}">Proyectos</a></li>
    <li><a href="{{ '/recursos.html' | relative_url }}">Recursos</a></li>
    <li><a href="{{ '/contacto.html' | relative_url }}">Contacto</a></li>

    {% elsif page.lang == "fr" %}
    <li><a href="{{ '/fr' | relative_url }}">Accueil</a></li>
    <li><a href="{{ '/fr/sobre-mi.html' | relative_url }}">À propos</a></li>
    <li><a href="{{ '/fr/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/fr/proyectos.html' | relative_url }}">Projets</a></li>
    <li><a href="{{ '/fr/recursos.html' | relative_url }}">Ressources</a></li>
    <li><a href="{{ '/fr/contacto.html' | relative_url }}">Contact</a></li>

    {% else %}
    <li><a href="{{ '/en' | relative_url }}">Home</a></li>
    <li><a href="{{ '/en/sobre-mi.html' | relative_url }}">About Me</a></li>
    <li><a href="{{ '/en/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/en/proyectos.html' | relative_url }}">Projects</a></li>
    <li><a href="{{ '/en/recursos.html' | relative_url }}">Resources</a></li>
    <li><a href="{{ '/en/contacto.html' | relative_url }}">Contact</a></li>
    {% endif %}
  </ul>
</div>
      