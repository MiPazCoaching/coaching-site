<nav id="navbar" class="navbar fixed-top" style="z-index: 9999;">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <!-- Branding con bandera al lado -->
    <div class="d-flex align-items-center gap-2">
      <a class="navbar-brand" href="{{ '/' | relative_url }}">M: Paz</a>

      {% if page.lang == 'es' %}
      <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}"
           alt="Español"
           style="width: 20px; height: 20px; border-radius: 50%;">
      {% else %}
      <img src="{{ '/assets/icons/gb.svg' | relative_url }}"
           alt="English"
           style="width: 20px; height: 20px; border-radius: 50%;">
      {% endif %}
    </div>

    <!-- Botones: Idioma, Tema, Menú -->
    <div class="d-flex align-items-center gap-2">

      <!-- Menú desplegable de idiomas -->
      <div class="dropdown" id="language-dropdown">
        <button class="icon-button dropdown-toggle"
                id="language-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="Cambiar idioma"
                title="Cambiar idioma">
        </button>

        {% comment %}
        Creamos una versión "base" del URL actual sin el prefijo '/en' (si lo tiene)
        Esto permite generar el path correcto en español que va en la raíz
        {% endcomment %}
        {% assign base_url = page.url | remove_first: '/en' %}

        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="language-toggle">
          <li>
            <a href="{{ base_url | relative_url }}" class="dropdown-item {% if page.lang == 'es' %}active{% endif %}">
              <img src="{{ '/assets/icons/es-variant.svg' | relative_url }}" alt="Español" class="flag-icon me-2" style="width:16px; height:16px;"> Español
            </a>
          </li>
          <li>
            <a href="{{ '/en' | append: base_url | relative_url }}" class="dropdown-item {% if page.lang == 'en' %}active{% endif %}">
              <img src="{{ '/assets/icons/gb.svg' | relative_url }}" alt="English" class="flag-icon me-2" style="width:16px; height:16px;"> English
            </a>
          </li>
        </ul>
      </div>

      <!-- Tema -->
      <div class="dropdown" id="themeDropdown">
        <button class="dropdown-toggle icon-button"
                id="theme-toggle"
                type="button"
                aria-haspopup="true"
                aria-expanded="false"
                aria-label="{% if page.lang == 'es' %}Cambiar tema{% else %}Change theme{% endif %}"
                title="{% if page.lang == 'es' %}Cambiar tema{% else %}Change theme{% endif %}">
          <span id="theme-icon"></span>
        </button>

        <ul class="dropdown-menu dropdown-menu-end" id="themeMenu" aria-labelledby="theme-toggle" role="menu">
          <li>
            <button class="dropdown-item" data-theme-choice="light" role="menuitem">
              <span class="theme-icon me-2">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M12 3v1M12 20v1M5.6 5.6l.7.7M17.7 17.7l.7.7M3 12h1M20 12h1M5.6 18.4l.7-.7M17.7 6.3l.7-.7M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"/>
                </svg>
              </span>
              {% if page.lang == 'es' %}Claro{% else %}Light{% endif %}
            </button>
          </li>
          <li>
            <button class="dropdown-item" data-theme-choice="dark" role="menuitem">
              <span class="theme-icon me-2">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 0 0 12 21a9 9 0 0 1 9-8.21z"/>
                </svg>
              </span>
              {% if page.lang == 'es' %}Oscuro{% else %}Dark{% endif %}
            </button>
          </li>

          <!-- Submenús de Daltonismo -->
          {% assign themes = "colorblind,colorblind-dark" | split: "," %}
          {% for theme in themes %}
          <li class="dropdown-submenu">
            <button class="dropdown-item dropdown-toggle"
                    data-theme-choice="{{ theme }}"
                    aria-haspopup="true"
                    aria-expanded="false">
              <span class="theme-icon me-2">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                  <circle cx="12" cy="12" r="6"/>
                  {% if theme == 'colorblind-dark' %}
                  <path d="M21 12.79A9 9 0 0 1 11.21 3" fill="none" stroke="currentColor"/>
                  {% endif %}
                </svg>
              </span>
              {% if theme == 'colorblind' %}
              {% if page.lang == 'es' %}Daltónico{% else %}Colorblind{% endif %}
              {% else %}
              {% if page.lang == 'es' %}Daltónico Oscuro{% else %}Colorblind Dark{% endif %}
              {% endif %}
            </button>
            <ul class="dropdown-menu" role="menu">
              <li class="dropdown-header" role="presentation">{% if page.lang == 'es' %}Tipo de Daltonismo{% else %}Colorblind Type{% endif %}</li>
              {% for type in "default,protanopia,deuteranopia,tritanopia" | split: "," %}
              <li><button class="dropdown-item" data-theme-choice="{{ theme }}-{{ type }}" role="menuitem">
                {% case type %}
                {% when 'default' %}{% if page.lang == 'es' %}Por defecto{% else %}Default{% endif %}
                {% when 'protanopia' %}{% if page.lang == 'es' %}Protanopía{% else %}Protanopia{% endif %}
                {% when 'deuteranopia' %}{% if page.lang == 'es' %}Deuteranopía{% else %}Deuteranopia{% endif %}
                {% when 'tritanopia' %}{% if page.lang == 'es' %}Tritanopía{% else %}Tritanopia{% endif %}
                {% endcase %}
              </button></li>
              {% endfor %}

              <li><hr class="dropdown-divider"></li>

              <li class="dropdown-header" role="presentation">{% if page.lang == 'es' %}Nivel de Contraste{% else %}Contrast Level{% endif %}</li>
              {% for level in "low,medium,high" | split: "," %}
              <li><button class="dropdown-item" data-theme-choice="{{ theme }}-{{ level }}" role="menuitem">
                {% case level %}
                {% when 'low' %}{% if page.lang == 'es' %}Bajo{% else %}Low{% endif %}
                {% when 'medium' %}{% if page.lang == 'es' %}Medio{% else %}Medium{% endif %}
                {% when 'high' %}{% if page.lang == 'es' %}Alto{% else %}High{% endif %}
                {% endcase %}
              </button></li>
              {% endfor %}
            </ul>
          </li>
          {% endfor %}
        </ul>
      </div>



      <button class="icon-button" id="menu-toggle" aria-label="Abrir menú" title="Menú"></button>
    </div>
  </div>
</nav>

<!-- Menú lateral -->
<div id="sidebar-wrapper" tabindex="-1" class="sidebar" aria-hidden="true" role="menu">
  <button class="icon-button" id="close-menu-toggle" aria-label="Cerrar menú" title="Cerrar"></button>

  <ul class="sidebar-nav list-unstyled">
    {% if page.lang == "es" %}
    <li><a href="{{ '/' | relative_url }}">Inicio</a></li>
    <li><a href="{{ '/sobre-mi.html' | relative_url }}">Sobre mí</a></li>
    <li><a href="{{ '/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/proyectos.html' | relative_url }}">Proyectos</a></li>
    <li><a href="{{ '/recursos.html' | relative_url }}">Recursos</a></li>
    <li><a href="{{ '/contacto.html' | relative_url }}">Contacto</a></li>
    {% else %}
    <li><a href="{{ '/en' | relative_url }}">Home</a></li>
    <li><a href="{{ '/en/sobre-mi.html' | relative_url }}">About Me</a></li>
    <li><a href="{{ '/en/posts.html' | relative_url }}">Devlogs</a></li>
    <li><a href="{{ '/en/proyectos.html' | relative_url }}">Projects</a></li>
    <li><a href="{{ '/en/recursos.html' | relative_url }}">Resources</a></li>
    <li><a href="{{ '/en/contacto.html' | relative_url }}">Contact</a></li>
    {% endif %}
  </ul>
</div>